---
import Navbar from "../components/Navbar.astro";
---
<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<title>Astro Basics</title>
<!-- Sinais de rede: barateiam o fetch do GA -->
  <link rel="dns-prefetch" href="https://www.googletagmanager.com">
  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>

  {(
    <>
      <script is:inline>
        // DataLayer antes do script externo (não bloqueia)
        window.dataLayer = window.dataLayer || [];
        function gtag(){ dataLayer.push(arguments); }

        // Consent Mode básico (ajuste conforme sua política/LGPD)
        gtag('consent', 'default', {
          ad_storage: 'denied',
          analytics_storage: 'granted',
          wait_for_update: 500
        });

        // Fila inicial
        gtag('js', new Date());
        gtag('config', 'G-PTQKGPQ7H0', {
          // GA4 já anonimiza IP por padrão; mantenho explícito por clareza
          anonymize_ip: true,
          transport_url: undefined,  // deixe padrão; remova se não usar proxy
          send_page_view: true
        });

        // Carrega gtag.js quando o navegador estiver ocioso (menos impacto)
        const loadGA = () => {
          const s = document.createElement('script');
          s.async = true;
          s.src = 'https://www.googletagmanager.com/gtag/js?id=G-PTQKGPQ7H0';
          document.head.appendChild(s);
        };
        if ('requestIdleCallback' in window) {
          requestIdleCallback(loadGA, { timeout: 2000 });
        } else {
          setTimeout(loadGA, 1200);
        }
      </script>
    </>
  )}
	</head>
	<body>
		<Navbar />
		<slot />
	</body>
</html>

<style>
	html,
	body {
		margin: 0;
		width: 100%;
		height: 100%;
	}
:root {
  --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
               Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans",
               "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif;
}

html { font-family: var(--font-sans); }
</style>
